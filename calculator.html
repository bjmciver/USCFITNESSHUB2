<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Calculator - Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Minimal styles so this is self-contained and won't conflict */
    :root{ --accent:#73000a; }
    body{ font-family:Arial, sans-serif; background:#f6f7f8; margin:0; padding:24px; color:#222; }
    .container{ max-width:960px; margin:0 auto; padding:0 12px; }
    .calculator-section{ padding:18px 0; }
    h2{ color:var(--accent); text-align:center; margin:0 0 6px; }
    p.subtitle{ text-align:center; color:#555; margin:0 0 18px; }

    .calc-grid{ display:grid; grid-template-columns: 1fr 360px; gap:18px; align-items:start; }
    @media (max-width:880px){ .calc-grid{ grid-template-columns:1fr; } }

    .card{ background:#fff; border:1px solid #e6e6e6; border-radius:10px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }

    label{ display:block; font-weight:700; margin:8px 0 6px; }
    input[type="number"], select { width:100%; padding:9px 10px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; }

    .goal-options{ display:flex; flex-direction:column; gap:8px; margin-top:6px; }
    .form-actions{ display:flex; gap:10px; margin-top:12px; }
    .btn{ padding:9px 14px; border-radius:8px; font-weight:700; cursor:pointer; border:none; }
    .btn-primary{ background:var(--accent); color:#fff; }
    .btn-secondary{ background:#fff; color:#111; border:1px solid #d0d0d0; }

    .calc-img{ width:100%; height:200px; object-fit:cover; border-radius:8px; display:block; }
    .result-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
    .result-box{ background:#f3f3f3; border-radius:8px; padding:10px; text-align:center; }
    .result-box strong{ display:block; font-size:1.2rem; color:#222; }

    /* small page footer note */
    .note{ margin-top:14px; font-size:0.9rem; color:#666; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <section id="calculator" class="calculator-section">
      <h2>Fitness Calculator</h2>
      <p class="subtitle">Enter your info below to get tailored calorie and protein goals.</p>

      <div class="calc-grid">
        <!-- LEFT: form -->
        <div class="card">
          <h3 style="margin-top:0;">Personal Information</h3>

          <!-- NOTE: the form has unique IDs and buttons use explicit IDs for JS -->
          <form id="calc-form" novalidate>
            <label for="height">Height (ft — decimal)</label>
            <input id="height" name="height" type="number" step="0.01" placeholder="5.10" value="5.10">

            <label for="weight">Weight (lbs)</label>
            <input id="weight" name="weight" type="number" placeholder="160" value="160">

            <label for="age">Age</label>
            <input id="age" name="age" type="number" placeholder="20" value="20">

            <label for="gender">Gender</label>
            <select id="gender" name="gender">
              <option>Male</option>
              <option>Female</option>
            </select>

            <label for="activity">Activity Level</label>
            <select id="activity" name="activity">
              <option value="1.2">Sedentary</option>
              <option value="1.375">Lightly Active</option>
              <option value="1.55">Moderately Active</option>
              <option value="1.725">Very Active</option>
            </select>

            <label>Goal</label>
            <div class="goal-options" role="radiogroup" aria-label="Goal">
              <label><input type="radio" name="goal" value="lose"> Lose Weight</label>
              <label><input type="radio" name="goal" value="maintain" checked> Maintain</label>
              <label><input type="radio" name="goal" value="gain"> Gain</label>
            </div>

            <div class="form-actions">
  <button type="button" id="calculate-btn" class="btn btn-primary">Calculate</button>
  <button type="button" id="reset-btn" class="btn btn-secondary">Reset</button>
</div>
          </form>
        </div>

        <!-- RIGHT: image + example + user result -->
        <div>
          <div class="card">
            <img class="calc-img" src="https://images.unsplash.com/photo-1685660477895-f1b6a417466b?auto=format&fit=crop&w=1080&q=60" alt="Health device">
          </div>

          <div class="card" style="margin-top:12px;">
            <h3 style="margin-top:0; text-align:center;">Example Result</h3>
            <p style="text-align:center; color:#555; margin:0 0 12px;">A 20-year-old student, 5’10”, 160 lbs, moderately active, trying to gain weight and muscle</p>
            <div class="result-grid">
              <div class="result-box"><strong>~2,700</strong><span>Calories to maintain</span></div>
              <div class="result-box"><strong>~170g</strong><span>Protein goal</span></div>
            </div>
          </div>

          <div id="user-result" class="card" style="margin-top:12px;">
            <h3 style="margin-top:0; text-align:center;">Your Result</h3>
            <p id="user-summary" style="text-align:center; color:#555; margin:0 0 12px;">Fill out the form and click calculate to see your results.</p>
            <div class="result-grid">
              <div class="result-box"><strong id="user-calories">0</strong><span>Calories to maintain</span></div>
              <div class="result-box"><strong id="user-protein">0g</strong><span>Protein goal</span></div>
            </div>
          </div>
        </div>
      </div>

      <p class="note">If this works, replace only your calculator fragment with matching IDs and handlers — do not duplicate IDs elsewhere.</p>
    </section>
  </div>

 <script>
(function () {
  function toNum(v, fallback = 0) {
    if (v == null) return fallback;
    const n = parseFloat(String(v).replace(/,/g,'').trim());
    return Number.isFinite(n) ? n : fallback;
  }

  // Robust goal reader — returns normalized key: 'lose'|'maintain'|'gain'
  function readGoal() {
    // 1) checked radio with value
    const checkedValue = (document.querySelector('input[name="goal"]:checked') || {}).value;
    if (checkedValue) {
      const normalized = normalizeGoal(checkedValue);
      if (normalized) return { raw: checkedValue, key: normalized, method: 'value-checked' };
    }

    // 2) any checked radio (maybe no name, but checked)
    const anyChecked = Array.from(document.querySelectorAll('input[type="radio"]')).find(r => r.checked);
    if (anyChecked) {
      // try its value
      if (anyChecked.value) {
        const normalized = normalizeGoal(anyChecked.value);
        if (normalized) return { raw: anyChecked.value, key: normalized, method: 'any-checked-value' };
      }
      // try label text (parent text)
      const parentText = (anyChecked.closest('label') || anyChecked.parentElement || {}).textContent || '';
      const normalizedLabel = normalizeGoal(parentText);
      if (normalizedLabel) return { raw: parentText.trim(), key: normalizedLabel, method: 'any-checked-label' };
    }

    // 3) try select named goal
    const sel = document.querySelector('select[name="goal"], select#goal');
    if (sel && sel.value) {
      const normalized = normalizeGoal(sel.value);
      if (normalized) return { raw: sel.value, key: normalized, method: 'select-value' };
    }

    // 4) try radios by scanning for radio groups inside #calculator and reading label text for the checked index
    const radios = Array.from(document.querySelectorAll('#calculator input[type="radio"], input[type="radio"]'));
    for (const r of radios) {
      if (r.checked) {
        const txt = (r.closest('label') || r.parentElement || {}).textContent || r.value || '';
        const normalized = normalizeGoal(txt);
        if (normalized) return { raw: txt.trim(), key: normalized, method: 'scanned-label' };
      }
    }

    // 5) fallback: read any radio's value/label if none checked (choose maintain)
    const first = radios[0];
    const fallbackRaw = first ? (first.value || ((first.closest('label')||{}).textContent || '')) : 'maintain';
    return { raw: fallbackRaw.trim(), key: 'maintain', method: 'fallback' };
  }

  function normalizeGoal(str) {
    if (!str) return null;
    const s = String(str).toLowerCase();
    if (s.includes('lose')) return 'lose';
    if (s.includes('gain')) return 'gain';
    if (s.includes('maintain') || s.includes('maintain')) return 'maintain';
    // allow short forms
    if (s === 'l' || s === 'loss') return 'lose';
    if (s === 'g') return 'gain';
    if (s === 'm') return 'maintain';
    return null;
  }

  function readInputs() {
    const weight = toNum(document.getElementById('weight')?.value, 160);
    const height = toNum(document.getElementById('height')?.value, 5.10);
    const age = toNum(document.getElementById('age')?.value, 20);
    const gender = (document.getElementById('gender')?.value || 'Male');
    const activity = toNum(document.getElementById('activity')?.value, 1.55);
    const goalInfo = readGoal();
    return { weight, height, age, gender, activity, goalInfo };
  }

  function applyGoalAdjustments(calories, weight, goalKey) {
    const multipliers = { lose: 0.85, maintain: 1.00, gain: 1.15 };
    const proteinPerLb = { lose: 1.2, maintain: 1.1, gain: 1.4 };
    const mult = multipliers[goalKey] ?? 1;
    const protein = Math.round(weight * (proteinPerLb[goalKey] ?? 1.1));
    const adjusted = Math.round(calories * mult);
    return { adjustedCalories: adjusted, proteinGrams: protein, multiplier: mult };
  }

  function updateDisplay(calories, protein, summary) {
    const c = document.getElementById('user-calories');
    const p = document.getElementById('user-protein');
    const s = document.getElementById('user-summary');
    if (c) c.textContent = "~" + calories;
    if (p) p.textContent = "~" + protein + "g";
    if (s) s.textContent = summary;
  }

  function calculateAndUpdate() {
    const { weight, height, age, gender, activity, goalInfo } = readInputs();
    console.log('[calc] inputs:', { weight, height, age, gender, activity, goalInfo });

    // compute BMR similar to your previous formula
    let bmr;
    if (String(gender).toLowerCase().startsWith('m')) {
      bmr = 66 + (6.23 * weight) + (12.7 * (height * 12)) - (6.8 * age);
    } else {
      bmr = 655 + (4.35 * weight) + (4.7 * (height * 12)) - (4.7 * age);
    }
    const maintenance = bmr * activity;

    const goalKey = (goalInfo && goalInfo.key) || 'maintain';
    const { adjustedCalories, proteinGrams, multiplier } = applyGoalAdjustments(maintenance, weight, goalKey);

    const summary = `Based on your info: ${age} y, ${height} ft, ${weight} lbs, activity ${activity} — goal: ${goalKey} (mult ${multiplier})`;
    console.log('[calc] maintenance:', Math.round(maintenance), 'adjusted:', adjustedCalories, 'protein:', proteinGrams);

    updateDisplay(adjustedCalories, proteinGrams, summary);
  }

  function doReset() {
    const form = document.getElementById('calc-form');
    if (form) form.reset();
    updateDisplay(0, 0, 'Fill out the form and click calculate to see your results.');
  }

  // Attach handlers robustly:
  function attachHandlers() {
    const form = document.getElementById('calc-form');
    if (form && !form._bound) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        calculateAndUpdate();
      });
      form._bound = true;
    }

    const calcBtn = document.querySelector('#calculator .form-actions button[type="submit"], #calculate-btn, .btn-primary');
    if (calcBtn && !calcBtn._bound) {
      calcBtn.addEventListener('click', function (e) {
        e.preventDefault();
        calculateAndUpdate();
      });
      calcBtn._bound = true;
    }

    const resetBtn = document.getElementById('reset-btn') || document.querySelector('#calculator .form-actions button[type="reset"]');
    if (resetBtn && !resetBtn._bound) {
      resetBtn.addEventListener('click', function (e) {
        e.preventDefault();
        doReset();
      });
      resetBtn._bound = true;
    }
  }

  attachHandlers();
  // in case fragment loads asynchronously, try again shortly
  setTimeout(attachHandlers, 120);
  setTimeout(attachHandlers, 600);

  // Expose for quick debugging:
  window.__usc_calc = { readGoal, readInputs, calculateAndUpdate, doReset };
})();
</script>
</body>
</html>


















