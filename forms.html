<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forms</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .error-message {
      color: #d9534f;
      font-size: 0.9em;
      margin-top: 4px;
      display: block;
    }
    input.invalid, textarea.invalid {
      border: 2px solid #d9534f;
      background-color: #fef2f2;
    }
  </style>
</head>
<body>
  <section id="forms" class="section">
    <div class="container">
      <h2 class="section-title">Feedback & Assessment Forms</h2>

      <div class="two-col">
        <!-- Fitness Assessment -->
        <div class="card">
          <h3>Fitness Assessment</h3>
          <form id="fitness-assessment-form" novalidate>
            <label for="fa-name">Name *</label>
            <input id="fa-name" name="name" type="text" required>

            <label for="fa-email">Email *</label>
            <input id="fa-email" name="email" type="email" required>

            <label>Goal</label>
            <div class="goal-options">
              <label><input type="radio" name="goal" value="lose"> Lose Weight</label>
              <label><input type="radio" name="goal" value="maintain" checked> Maintain</label>
              <label><input type="radio" name="goal" value="gain"> Gain</label>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Submit</button>
              <button type="reset" class="btn">Reset</button>
            </div>
          </form>
        </div>

        <!-- Feedback Form -->
        <div class="card">
          <h3>Feedback Form</h3>
          <form id="feedback-form" novalidate>
            <label for="fb-name">Name *</label>
            <input id="fb-name" name="name" type="text" required>

            <label for="fb-email">Email *</label>
            <input id="fb-email" name="email" type="email" required>

            <label for="fb-comments">Comments</label>
            <textarea id="fb-comments" name="comments" rows="6"></textarea>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Submit</button>
              <button type="reset" class="btn">Reset</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('validator: loaded');

    // Strict email: must contain "@" and end with .com or .net
    function isValidEmail(value) {
      // NOTE: use single backslash \s inside regex literal (not \\s)
      return /^[^\s@]+@[^\s@]+\.(com|net)$/i.test(value.trim());
    }

    function showError(el, msg) {
      clearError(el);
      const error = document.createElement('span');
      error.className = 'error-message';
      error.textContent = msg;
      // insert after the element
      el.insertAdjacentElement('afterend', error);
      el.classList.add('invalid');
    }

    function clearError(el) {
      if (!el) return;
      el.classList.remove('invalid');
      const next = el.nextElementSibling;
      if (next && next.classList.contains('error-message')) next.remove();
    }

    function validateForm(form) {
      let valid = true;
      const requiredInputs = Array.from(form.querySelectorAll('[required]'));
      console.log('validator: found required inputs:', requiredInputs.map(i => i.id || i.name || i.type));

      requiredInputs.forEach(input => {
        clearError(input);
        const val = (input.value || '').toString();
        if (!val.trim()) {
          console.log('validator: invalid (empty):', input.id || input.name);
          showError(input, 'This field is required');
          valid = false;
          return;
        }
        if (input.type === 'email') {
          if (!isValidEmail(val)) {
            console.log('validator: invalid (email):', input.id || input.name, 'value:', val);
            showError(input, 'Please enter a valid email (must include @ and end with .com or .net)');
            valid = false;
            return;
          }
        }
      });

      // Radio group check for fitness form
      if (form.id === 'fitness-assessment-form') {
        const radios = form.querySelectorAll('input[name="goal"]');
        if (radios.length) {
          const anyChecked = Array.from(radios).some(r => r.checked);
          // remove existing radio error
          const existing = form.querySelector('.error-message--radio');
          if (existing) existing.remove();
          if (!anyChecked) {
            console.log('validator: invalid (radio goal not selected)');
            const err = document.createElement('span');
            err.className = 'error-message error-message--radio';
            err.textContent = 'Please select a goal';
            radios[radios.length - 1].insertAdjacentElement('afterend', err);
            valid = false;
          }
        }
      }

      console.log('validator: form valid?', valid);
      return valid;
    }

    document.querySelectorAll('form').forEach(form => {
      // ensure novalidate is set so browser native popups don't interfere
      form.setAttribute('novalidate', 'novalidate');

      form.addEventListener('submit', e => {
        console.log('validator: submit event for form', form.id);
        e.preventDefault();
        e.stopPropagation();

        // clear any leftover radio errors
        form.querySelectorAll('.error-message--radio').forEach(n => n.remove());

        const ok = validateForm(form);
        if (!ok) {
          console.log('validator: prevented submit due to validation errors');
          // focus the first invalid input (nice UX)
          const firstInvalid = form.querySelector('.invalid');
          if (firstInvalid && typeof firstInvalid.focus === 'function') firstInvalid.focus();
          return;
        }

        // If validation passed: do actual submit logic here.
        // For now show a success message and reset the form (no navigation).
        alert('✅ Form passed validation — replace this with your submit logic.');
        form.reset();
        form.querySelectorAll('.error-message').forEach(n => n.remove());
        form.querySelectorAll('.invalid').forEach(i => i.classList.remove('invalid'));
      });

      form.addEventListener('input', e => {
        if (!e.target) return;
        if (e.target.type === 'radio') {
          // clear radio error for group
          const name = e.target.name;
          form.querySelectorAll('.error-message--radio').forEach(n => n.remove());
          return;
        }
        if (e.target.matches('[required], input[type="email"], textarea')) {
          clearError(e.target);
        }
      });

      form.addEventListener('reset', () => {
        // clear errors after native reset finishes
        setTimeout(() => {
          form.querySelectorAll('.error-message').forEach(n => n.remove());
          form.querySelectorAll('.invalid').forEach(i => i.classList.remove('invalid'));
        }, 0);
      });
    });

    // defensive: prevent anchor jumps from href="#" or href=""
    document.addEventListener('click', e => {
      const a = e.target.closest ? e.target.closest('a') : null;
      if (a && (a.getAttribute('href') === '#' || a.getAttribute('href') === '')) {
        e.preventDefault();
      }
    });

  });
  </script>
</body>
</html>







