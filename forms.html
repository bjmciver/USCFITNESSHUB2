<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Feedback & Assessment Forms</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      margin: 18px;
      color: #222;
      background: #f7f8fb;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h2 { margin-bottom: 14px; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e3e6ec;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      box-sizing: border-box;
      border: 1px solid #cfd6e3;
      border-radius: 6px;
      font-size: 0.95rem;
    }
    textarea { resize: vertical; }
    .goal-options label { display: inline-block; margin-right: 12px; font-weight: 400; }
    .form-actions { margin-top: 16px; display: flex; gap: 10px; }
    .btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #cfd6e3;
      background: #f4f6fb;
      cursor: pointer;
    }
    .btn-primary {
      background: #0575e6;
      color: #fff;
      border-color: rgba(0,0,0,0.06);
    }
    .error-message {
      color: #d9534f;
      font-size: 0.9rem;
      margin-top: 5px;
      display: block;
    }
    input.invalid, textarea.invalid {
      border: 2px solid #d9534f;
      background: #fff5f5;
    }
    @media (max-width:700px){ .two-col{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <section id="forms" class="section">
    <div class="container">
      <h2>Feedback & Assessment Forms</h2>

      <div class="two-col">
        <!-- Fitness Assessment -->
        <div class="card">
          <h3>Fitness Assessment</h3>
          <form id="fitness-assessment-form" novalidate>
            <label for="fa-name">Name *</label>
            <input id="fa-name" name="name" type="text" required>

            <label for="fa-email">Email *</label>
            <input id="fa-email" name="email" type="email" required>

            <label>Goal</label>
            <div class="goal-options">
              <label><input type="radio" name="goal" value="lose"> Lose Weight</label>
              <label><input type="radio" name="goal" value="maintain" checked> Maintain</label>
              <label><input type="radio" name="goal" value="gain"> Gain</label>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Submit</button>
              <button type="reset" class="btn">Reset</button>
            </div>
          </form>
        </div>

        <!-- Feedback Form -->
        <div class="card">
          <h3>Feedback Form</h3>
          <form id="feedback-form" novalidate>
            <label for="fb-name">Name *</label>
            <input id="fb-name" name="name" type="text" required>

            <label for="fb-email">Email *</label>
            <input id="fb-email" name="email" type="email" required>

            <label for="fb-comments">Comments</label>
            <textarea id="fb-comments" name="comments" rows="6"></textarea>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Submit</button>
              <button type="reset" class="btn">Reset</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

 <script>
(function () {
  // Guard to avoid double-binding if SPA mounts fragment multiple times
  if (window.__usc_forms_fragment_bound) return;
  window.__usc_forms_fragment_bound = true;

  // Find fragment root and forms
  const root = document.getElementById('forms') || document.querySelector('section');
  if (!root) return;

  // Utility selectors scoped to this fragment
  const $ = (sel) => root.querySelector(sel);
  const $$ = (sel) => Array.from(root.querySelectorAll(sel));

  // Helper: show inline error after the field
  function showError(input, message) {
    clearError(input);
    const span = document.createElement('span');
    span.className = 'error-message';
    span.textContent = message;
    input.insertAdjacentElement('afterend', span);
    input.classList.add('invalid');
  }

  function clearError(input) {
    if (!input) return;
    input.classList.remove('invalid');
    const nxt = input.nextElementSibling;
    if (nxt && nxt.classList.contains('error-message')) nxt.remove();
  }

  // Validate a single form element using HTML validity first (pattern/minlength/etc),
  // fall back to a custom radio-group check when needed.
  function validateForm(form) {
    let valid = true;

    // Use HTML5 input constraints where possible
    const requiredEls = Array.from(form.querySelectorAll('[required]'));
    requiredEls.forEach(el => {
      clearError(el);
      // For radios, skip here (we'll handle radio groups separately)
      if (el.type === 'radio') return;
      // If the browser reports an invalid constraint, use the browser message if available
      if (!el.checkValidity()) {
        const msg = el.title || el.validationMessage || 'Invalid value';
        showError(el, msg);
        valid = false;
      }
    });

    // Radio groups: check each distinct name where radio inputs exist inside this form
    const radioNames = new Set(Array.from(form.querySelectorAll('input[type="radio"]')).map(r => r.name));
    radioNames.forEach(name => {
      const radios = Array.from(form.querySelectorAll(`input[type="radio"][name="${name}"]`));
      if (!radios.length) return;
      // If any radio has required attribute then this group must have a selection
      const groupRequired = radios.some(r => r.hasAttribute('required'));
      if (!groupRequired) return; // only enforce if author marked group as required
      const anyChecked = radios.some(r => r.checked);
      // remove existing group error
      radios.forEach(r => {
        const existing = r.parentNode.querySelector('.error-message--radio');
        if (existing) existing.remove();
      });
      if (!anyChecked) {
        const err = document.createElement('span');
        err.className = 'error-message error-message--radio';
        err.textContent = 'Please select an option';
        // append after last radio element
        radios[radios.length - 1].insertAdjacentElement('afterend', err);
        valid = false;
      }
    });

    return valid;
  }

  // Attach handlers to forms inside the fragment
  $$( 'form' ).forEach(form => {
    // We'll manage validation UI ourselves
    form.setAttribute('novalidate','novalidate');

    form.addEventListener('submit', e => {
      e.preventDefault();
      e.stopPropagation();

      // clear any radio-group errors before validating
      form.querySelectorAll('.error-message--radio').forEach(n => n.remove());

      const ok = validateForm(form);
      if (!ok) {
        // focus first invalid element for better UX
        const firstInvalid = form.querySelector('.invalid, .error-message--radio');
        if (firstInvalid) {
          // if an error-message element is selected, focus previous input
          if (firstInvalid.classList && firstInvalid.classList.contains('error-message--radio')) {
            const prev = firstInvalid.previousElementSibling;
            if (prev && prev.focus) prev.focus();
          } else if (firstInvalid.focus) {
            firstInvalid.focus();
          }
        }
        return;
      }

      // If you want to submit normally uncomment the next line:
      // form.submit();

      // Default action: replace this with AJAX/post to backend
      // For now show a confirmation and reset
      alert('Form passed validation â€” replace with your submit logic.');
      form.reset();
      // clean up errors
      form.querySelectorAll('.error-message').forEach(n => n.remove());
      form.querySelectorAll('.invalid').forEach(i => i.classList.remove('invalid'));
    });

    // Live-clear errors while typing/choosing
    form.addEventListener('input', (ev) => {
      const t = ev.target;
      if (!t) return;
      if (t.type === 'radio') {
        // clear radio group messages for that name
        const radios = Array.from(form.querySelectorAll(`input[type="radio"][name="${t.name}"]`));
        radios.forEach(r => {
          const existing = r.parentNode.querySelector('.error-message--radio');
          if (existing) existing.remove();
        });
        return;
      }
      if (t.matches('[required], input[type="email"], textarea, input')) {
        clearError(t);
      }
    });

    // Clear errors on reset
    form.addEventListener('reset', () => {
      setTimeout(() => {
        form.querySelectorAll('.error-message').forEach(n => n.remove());
        form.querySelectorAll('.invalid').forEach(i => i.classList.remove('invalid'));
      }, 0);
    });
  });

  // Optional: expose a global validate function if you want central control
  window.__usc_validate_form = function(form) { return validateForm(form); };

})();
</script>
</body>
</html>






